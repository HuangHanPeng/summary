# GIPO

###  GPIO输入

4种模式

#### 1.浮空

> 当输入高电平时，IO口处于高阻态，电位不确定，完全由外部输入决定（需要接入上拉或下拉电阻），上拉为高电平，下拉为低电平，一般用于按键控制

#### 2.上拉和下拉

>上拉为拉高电压，将输入变为高电平，下拉为拉低电压，将输入变为低电平

#### 3.模拟输入

> 将数字信号转化为模拟信号

### GPIO输出

#### 开漏输出

> 开漏输出（由cpu写入寄存器）
>
> 开漏用途：用于匹配电平。（即本身电平可以由外部决定）
>
> 开漏引脚不连接外部的上拉电阻时一般只能输出低电平。
>
> ![image-20200328025058614](C:\Users\86189\AppData\Roaming\Typora\typora-user-images\image-20200328025058614.png)
>
> （图片来自正点原子）
>
> 开漏输出模式原理：当cpu写入1进寄存器，N-MOS截止（P-MOS未导通），IO此时属于高阻态，由外接上拉或下拉决定输出高低电平。当cpu写入0进寄存器，N-MOS导通（P-MOS未导通），此时IO输出低电平。
>
> 
>
> #### 复用开漏输出
>
> 原理于开漏输出相同，但输出不是由cpu输入到寄存器，而是由外设模块写入。

#### 推挽输出

推挽输出可以输出高,低电平

> ![](C:\Users\86189\AppData\Roaming\Typora\typora-user-images\image-20200328031805151.png)
>
> 当输入1时，P-MOS导通（IO口接Vcc），N-MOS截止，输出高电平，
>
> 当输入0时，P-MOS截止，N-MOS导通（IO接地），输出低电平。
>
> #### 复用推挽输出
>
> 原理相同，由外设模块决定输入值。

* #### 复用：不仅能作为IO使用，还能作为外设引脚（例如PA9 PA10复用为串口）

### 寄存器

每组GPIO口有：

2个32位配置寄存器（GPIOx_CRL）（配置IO口）

> 配置每个IO需要4位，每组GPIO有16个IO口，所以需要两个32位寄存器（高/低寄存器）
>
> 输入不同二进制，代表不同功能。
>
> 对于每个IO口中的4位，有两位用来配置输入或输出模式，另外两位用来配置具体模式。
>
> MODE用来配置输入或输出模式以及速度：
>
> > 00：输入模式（复位后的状态）
> >
> > 01：输出模式,最大速度位10MHz
> >
> > 10：输出模式，最大速度2MHZ
> >
> > 11：输出模式，最大速度50MHz
>
> CNF用来配置具体模式:
>
> 输入模式时：
>
> > 00：模拟输入
> >
> > 01：浮空输入（复位后状态）
> >
> > 10：上拉/下拉（上拉或下拉由ODR寄存器另外配置上拉1，下拉0）
> >
> > 11：保留
>
> 输出模式时：
>
> >00：推挽
> >
> >01：开漏
> >
> >10：复用推挽
> >
> >11：复用开漏

2个32位数据寄存器

端口输入数据寄存器（GPIOx_IDR）

> 用途：读取端口输入数据
>
> IDR寄存器低16位每个位对应一个IO口，读取IO口输入的电平，高16位保留

端口输出数据寄存器（GPIOx_ODR）

> ORD寄存器低16位控制每个IO口的输出，高16位保留。
>
> 在输入模式下可以配置上拉或下拉，ODR低16位最低位0对应下拉，1对应上拉

1个32位置位/复位寄存器

> 端口位设置/清除寄存器（GPIOx_BSRR）
>
> 设置ODR寄存器
>
> 低16位：设置为0时ODR不影响，设置为1时：对应ODR为1
>
> 高16位：设置为0时ODR不影响，设置为1时：对应ODR清除为0.

1个16复位寄存器

> 同BSRR高16位

1个32位锁存器

每个IO必须按32位字被访问 

