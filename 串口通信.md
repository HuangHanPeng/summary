## 串口通信

#### 串行通信

传输原理：数据按位顺序传输

> 传输数据的方向：
>
> * 单工 ：数据只能在一个方向上传输
> * 半双工 ：数据分时刻双向传输
> * 双工 ：同时双向传输
>
> 传送的两种方式：
>
> * 同步通讯：带时钟同步信号传输
> * 异步通信：不带时钟同步信号传输（双方需约定波特率）
>
> 常见串行通讯接口：
>
> * UART：
>
>   > 引脚：RXT,TXD,GND
>   >
>   > 通讯方式：全双工异步通讯
>
> * 单总线：
>
>   > 通讯方式：半双工异步通讯
>
> * SPI：
>
>   > 引脚：SCK（同步时钟），MISO，MOSI（输入输出端）
>   >
>   > 通讯方式：全双工同步通讯
>
> * I2C：
>
>   > 引脚：SCL（同步时钟），SDA（输入输出端）
>   >
>   > 通讯方式：半双工同步通讯

#### 并行通信

传输原理：数据各个位同时传输

#### STM32d的串口通信接口

* ##### 波特率

  

* ##### UART

  > 通用异步收发器
  >
  > 引脚：RXD：数据接受
  >
  > ​			TXD：数据发送
  >
  > 检测标志：
  >
  > * 接受缓存器
  >
  > * 发送缓冲器空
  >
  > * 传输结束标志
  >
  > 支持1或2位停止
  >
  > 串口异步通信需要定义的参数：
  >
  > * 起始位
  >
  > * 数据位
  >
  > * 奇偶校验位
  >
  > * 停止位
  >
  > * 波特率设置
  >
  > 串口通讯过程
  >
  > ![image-20200329124351464](C:\Users\86189\AppData\Roaming\Typora\typora-user-images\image-20200329124351464.png)
  >
  > 发送接受过程可以概况为：MCU—缓冲器—移位寄存器—外设设备
  >
  > 其中移位寄存器又由控制器控制，控制器中有CR1，SR寄存器，存储了串口设置的数据
  >
  > 发送和接收由波特率控制
  >
  > 输入移位寄存器和输出以为寄存器分别由接收控制器和发送控制器控制
  >
  > 而控制器又控制了时钟（发送接收两个时钟），时钟受到同一个单元控制（该单元由波特率控制）单元内部有发送器和接收器波特率控制。

##### 串口常用寄存器

USART_SR：状态寄存器（存储串口状态相关数据：如发送是否完成，由0和1表示）

USART_DR：数据寄存器（发送和接收的数据存储）发送数据时写入该寄存器，接受数据时读取该寄存器

USART_BRR：波特率寄存器：

使用低16位表示，0~3位表示小数部分（DIV_Fraction），4~15位表示整数部分（DIV_Mantissa）

> ##### 波特率计算
>
> f (PCLKx)/(16*USARTDIV)
>
> 其中f (PCLKx）是给串口的时钟，计算波特率只需要计算USARTDIV即可
>
> 在设置波特率时，波特率是给出的，时钟也是给出的，将USARTDIV算出并设置DIV_Mantissa，		DIV_Fraction（16进制表示）

串口操作相关库函数：

> * 使能函数
>   * void USART_init(); 串口初始化（波特率，数据字长，奇偶校验，硬件流控，收发使能）
>   * void USART_Cmd();（）使能串口
>   * void USART_ITConfig();使能中断相关
> * 数据发送和接收
>   * void USART_SendData(); 发送数据
>   * uint16_t USART  ReceiveData()；接受数据
> * 设置标志
>   * FlagStatus USART_GetFlagStus();获取状态标志位
>   * void USART_ClearFlag();清除标志位
>   * ITStatus USART_GetITStatus();获取中断状态标志位
>   * void USART_ClearnITPendingBit();清除中断状态标志位